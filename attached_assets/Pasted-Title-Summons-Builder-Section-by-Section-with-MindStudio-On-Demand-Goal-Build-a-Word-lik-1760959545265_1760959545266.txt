Title: “Summons Builder — Section-by-Section with MindStudio (On-Demand)”

Goal:
Build a Word-like (Word UI: it should look like an A4 editor, whitout edit functionalities) A4 drafting experience where the user generates a civil summons (kantonrechter) in sections. Only the first section (“Aanzegging / Notice of appearance”) is fixed and inserted exactly as uploaded from the app. All other sections are generated by MindStudio via On-Demand (Run-API) calls, with an approve/revise loop per section. No templates are rendered from static files anymore; the page is composed from section outputs.

Scope (first release):

One Aanzegging variant (exact fixed text uploaded in the app, to be uploaded later).

Sections to generate in order:

Aanzegging (fixed, no edits in-app)

Jurisdiction & venue (Bevoegdheid en relatieve competentie)

Facts (Feiten)

Legal framework & grounds (Juridisch kader & Rechtsgronden)

Defenses & rebuttal (Verweer en weerlegging)

Evidence offer (Bewijsaanbod)

Claims / petitum (Vorderingen)

Exhibits list (Producties)

Operating principles:

On-Demand only (no webhooks).

Each section has a “Generate” button.

After generation, the section shows status: Draft → Approved or Needs changes.

If “Needs changes,” the user types change instructions in a free-text box and clicks “Revise.” The same section flow is called with the feedback; this repeats until Approved.

The first section (Aanzegging) is not editable; it is inserted exactly as provided.

After a section is Approved, the next section’s Generate button becomes enabled (strict order).

The whole document is rendered vertically like A4 pages (Word-like look). Each section flows into the A4 layout; show page breaks visually.

UI requirements:

A4 canvas layout

Centered document column with realistic page width and margins.

Page break indicators between virtual A4 pages.

Consistent heading styles for section titles; body text appears as continuous paragraphs.

Section blocks (stacked top-to-bottom)

Header: Section number + title + status badge.

Actions: Generate (or Regenerate), Approve, Needs changes.

When “Needs changes” is selected, show a multiline “Change request” text area and a “Revise” button.

Disabled controls until dependencies are met (e.g., can’t generate Facts until Jurisdiction is Approved (In Dutch) ).

Aanzegging section

Read-only. Render the exact uploaded text. No edit/feedback controls.

Footer controls

“Compile full preview” (enabled only when all sections are Approved).

“Export PDF/Docx” (optional for later).

Visual feedback

Subtle loaders on Run-API calls.

Inline warning banners if a section returns warnings or is not “ready”.

Data model & state (client):

case_id (UUID)

analysis_json (result from prior analysis flow)

fixed_notice_text (the exact uploaded Aanzegging)

section_states: for each section keep { status, last_output, warnings, user_feedback_history }

run_context: { template_id: “T-01” (for now), user_input_json (optional), prior_sections (latest approved outputs) }

MindStudio invocation rules (for every generative section):

Launch variables (input):

case_id

analysis_json

prior_sections (dictionary containing the latest Approved content of earlier sections)

user_feedback (optional; free-text change request when revising)

Output (End-block):

End-block must have Key = “section_result” and Value = a JSON object with:

section: “<section_name>”

ready: boolean (true if suitable for approval or preview)

warnings: array of strings (empty if none)

content: object with finalized text for that section (structured if needed)

trace: { confidence: number 0–1, notes: string }

If ready = false, still return a minimal content block that can be displayed, and include warnings.

Temperature low for jurisdiction and claims; medium for facts and grounds.

Section-specific expectations (content keys):

Jurisdiction: provide a concise, citeable reasoning paragraph (will be rendered as that section’s body).

Facts: provide a tight narrative paragraph; optional timeline to be flattened into prose.

Legal grounds: provide a consolidated, citeable paragraph combining legal basis and application to facts.

Defenses & rebuttal: short list of likely defenses + integrated rebuttal paragraph; render as a coherent section.

Evidence offer: a formal paragraph (“voor zover nodig”) listing witnesses/documents; render as prose.

Claims/petitum: numbered petitum lines in a single block, formatted for judgment-readiness.

Exhibits: numbered list with short purpose; render as a compact paragraph list.

Interaction flow per section (except Aanzegging):

User clicks Generate → call corresponding MindStudio flow with input (case_id, analysis_json, prior_sections, user_feedback if present).

Render the returned “content” in the A4 canvas.

If user clicks Approve → set section status to Approved, store output in prior_sections, enable next section.

If user clicks Needs changes → show “Change request” text area. On “Revise”, re-call the same flow including user_feedback; render new output; loop until Approved.

Validation & gating:

Enforce order strictly. Next section only enabled if previous is Approved.

If warnings exist, show them inline and keep status = Draft until the user Approves.

Allow the user to backtrack and “Reopen” a prior section, which invalidates downstream sections (set them back to Draft) until re-approved.

Compile full preview:

When all sections are Approved, assemble the final document for preview by concatenating:
Aanzegging (fixed) → Jurisdiction → Facts → Legal grounds → Defenses & rebuttal → Evidence offer → Claims → Exhibits.

Render the compiled view on the same A4 canvas with page breaks.

Exports can be added later; current goal is on-screen preview.

Resilience & UX details:

Persist section_states locally per case_id.

Show a light “history” per section (latest 3 revisions) accessible via a small “History” link.

If a Run-API call fails, display a retry banner with the captured user_feedback retained.

All timestamps and numbers in EU formats; dates dd-mm-yyyy.

Security & privacy:

Do not log raw personal data beyond what’s needed for rendering the draft.

Mask e-mail/phone in UI previews if not essential to the section text (configurable later).

Non-goals (this iteration):

Multiple Aanzegging variants, router branching, or automatic scheduling with court calendars.

Template-file rendering. We only compose the document from section outputs plus the fixed notice text.

Acceptance criteria:

The page looks and feels like drafting in Word: centered A4, realistic margins, visible page breaks, consistent typography.

Each section shows Generate, Approve, Needs changes → Revise; Aanzegging is read-only.

Strict gating: cannot generate section N+1 until section N is Approved.

Revise loop resubmits user feedback to the same MindStudio flow and updates the section text.

End-block compliance in MindStudio: Key = “section_result”, Value = JSON with fields listed above.

“Compile full preview” generates a continuous A4 document using the fixed Aanzegging plus all Approved sections.